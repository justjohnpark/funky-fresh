<%= form_for @user do |f| %>
  <h1>Register</h1>
  <% if @user.errors.any? %>
  <div id="error_explanation">
    <h2><%= pluralize(@user.errors.count, "error") %> Process failed because:</h2>
    <ul>
    <% @user.errors.full_messages.each do |msg| %>
      <li><%= msg %></li>
    <% end %>
    </ul>
  </div>
  <% end %>
  <p>
    <%= f.text_field :first_name, :placeholder => 'First Name' %>
  </p>

  <p>
    <%= f.text_field :last_name, :placeholder => 'Last Name' %>
  </p>

  <p class="email-input-register">
    <%= f.text_field :email, :placeholder => 'Email' %> <span class="email-input-notice"> </span>
  </p>

  <p class="password-input-register">
    <%= f.password_field :password, :placeholder => 'Password' %> <span class="password-input-notice"> </span>
  </p>

  <p>
    <%= f.password_field :password_confirmation, :placeholder => 'Confirm Password' %>
  </p>

  <% if @token != nil %>
    <%= hidden_field_tag :invite_token, @token %>
  <% end %>

  <p>
    <%= f.submit "Register" %>
  </p>

<% end %>

<script>
$(document).ready(function($) {
    var email = false;
    var password = false;
    var matchingPasswordInput = false;
    var firstName = true;
    var lastName = false;
    
    $(".password-input-register").on("click", function(){$(".password-input-notice").html("Use at least 6 characters. Include both an upper and a lower case letter.");});
    
    if (email === false || password === true) {$("input[name='commit']").attr("disabled", "disabled");}

    $("input#user_email").on('keyup', function() {
        console.log("eval email:" + email)
      var emailInput = $("form input#user_email").val();
      var emailPattern = /[\w.]+@\w+(\.\w{2,})+/;
      if (emailPattern.test(emailInput)) {
        email = true;
        console.log("in the email loop");
      }
      if (email === true && password === true && matchingPasswordInput === true) {$("input[name='commit']").removeAttr("disabled");}
    });
  
    $("input#user_password").on('keyup', function() {
      var passwordInput = $("input#user_password").val();
      var passwordPattern = /((?=.*d)(?=.*[a-z])(?=.*[A-Z]).{6})/gm;
      if (passwordPattern.test(passwordInput)) {
        console.log("eval password:" + password)
        password = true;
        }
      if (email === true && password === true && matchingPasswordInput === true) {$("input[name='commit']").removeAttr("disabled");}
 
    });

    $("input#user_password_confirmation").on('keyup', function() {
      var passwordInput = $("input#user_password").val();
      var passwordConfirmationInput = $("input#user_password_confirmation").val();
      if (passwordInput === passwordConfirmationInput) {matchingPasswordInput = true;} 
      console.log("eval conf p:" + matchingPasswordInput )
      if (email === true && password === true && matchingPasswordInput === true) {$("input[name='commit']").removeAttr("disabled");}
      });
  });
</script>

